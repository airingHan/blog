

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="韩启川">
  <meta name="keywords" content="">
  
    <meta name="description" content="历史演化物理机时代   —&gt;   虚拟化时代 			—&gt;    容器化时代 物理机时代部署非常慢 成本很高 资源浪费 难于扩展与迁移 受制于硬件 虚拟化时代多部署 资源池 资源隔离 很容易扩展 VM需要安装操作系统 容器化时代容器架构降低了硬件成本 更快速的部署开发&#x2F;测试&#x2F;生产环境 更简便的维护开发&#x2F;测试&#x2F;生产环境 与微服务架构更为契合 容器化技">
<meta property="og:type" content="article">
<meta property="og:title" content="docker入门">
<meta property="og:url" content="http://hanqichuan.com/2022/08/10/devops/docker%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="这是一个很酷的事">
<meta property="og:description" content="历史演化物理机时代   —&gt;   虚拟化时代 			—&gt;    容器化时代 物理机时代部署非常慢 成本很高 资源浪费 难于扩展与迁移 受制于硬件 虚拟化时代多部署 资源池 资源隔离 很容易扩展 VM需要安装操作系统 容器化时代容器架构降低了硬件成本 更快速的部署开发&#x2F;测试&#x2F;生产环境 更简便的维护开发&#x2F;测试&#x2F;生产环境 与微服务架构更为契合 容器化技">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://hanqichuan.com/.com//%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%B6%E6%9E%84%E5%9B%BE.png">
<meta property="og:image" content="http://hanqichuan.com/.com//docker%E6%A8%A1%E5%9D%97%E5%9B%BE.svg">
<meta property="og:image" content="http://hanqichuan.com/.com//%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82.png">
<meta property="og:image" content="http://hanqichuan.com/.com//%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F.png">
<meta property="article:published_time" content="2022-08-10T08:05:00.000Z">
<meta property="article:modified_time" content="2023-11-16T05:55:53.274Z">
<meta property="article:author" content="韩启川">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://hanqichuan.com/.com//%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%B6%E6%9E%84%E5%9B%BE.png">
  
  
  <title>docker入门 - 这是一个很酷的事</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"hanqichuan.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>这是一件很酷的事</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="docker入门">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-08-10 16:05" pubdate>
        2022年8月10日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      16k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      131 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">docker入门</h1>
            
            <div class="markdown-body">
              <h1 id="历史演化"><a href="#历史演化" class="headerlink" title="历史演化"></a>历史演化</h1><p>物理机时代   —&gt;   虚拟化时代 			—&gt;    容器化时代</p>
<h2 id="物理机时代"><a href="#物理机时代" class="headerlink" title="物理机时代"></a>物理机时代</h2><p>部署非常慢</p>
<p>成本很高</p>
<p>资源浪费</p>
<p>难于扩展与迁移</p>
<p>受制于硬件</p>
<h2 id="虚拟化时代"><a href="#虚拟化时代" class="headerlink" title="虚拟化时代"></a>虚拟化时代</h2><p>多部署</p>
<p>资源池</p>
<p>资源隔离</p>
<p>很容易扩展</p>
<p>VM需要安装操作系统</p>
<h2 id="容器化时代"><a href="#容器化时代" class="headerlink" title="容器化时代"></a>容器化时代</h2><p>容器架构降低了硬件成本</p>
<p>更快速的部署开发&#x2F;测试&#x2F;生产环境</p>
<p>更简便的维护开发&#x2F;测试&#x2F;生产环境</p>
<p>与微服务架构更为契合</p>
<h3 id="容器化技术的应用场景"><a href="#容器化技术的应用场景" class="headerlink" title="容器化技术的应用场景"></a>容器化技术的应用场景</h3><p>标准化的迁移方式</p>
<p>统一的参数配置</p>
<p>自动化部署</p>
<p>应用集群监控</p>
<p>开发与运维之间的沟通桥梁</p>
<h2 id="虚拟化与容器化对比"><a href="#虚拟化与容器化对比" class="headerlink" title="虚拟化与容器化对比"></a>虚拟化与容器化对比</h2><p><img src="/.com//%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%B6%E6%9E%84%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt="虚拟化与容器化架构图"></p>
<h3 id="左图是虚拟机"><a href="#左图是虚拟机" class="headerlink" title="左图是虚拟机"></a>左图是虚拟机</h3><p>从下到上理解:</p>
<ul>
<li><strong>基础设施(Infrastructure)<strong>。它可以是你的</strong>个人电脑</strong>，数据中心的<strong>服务器</strong>，或者是<strong>云主机</strong>。</li>
<li><strong>主机操作系统（Host Operating System）</strong></li>
<li><strong>虚拟机管理系统(Hypervisor)<strong>。利用Hypervisor，可以在</strong>主操作系统</strong>之上运行多个不同的<strong>从操作系统</strong>。类型1的Hypervisor有支持MacOS的<strong>HyperKit</strong>，支持Windows的<strong>Hyper-V、Xen</strong>以及<strong>KVM</strong>。类型2的Hypervisor有VirtualBox和VMWare workstation。</li>
<li><strong>客户机操作系统(Guest Operating System)<strong>。假设你需要运行3个相互隔离的应用，则需要使用Hypervisor启动3个</strong>客户机操作系统</strong>，也就是3个<strong>虚拟机</strong>。这些虚拟机都非常大，也许有700MB，这就意味着它们将占用2.1GB的磁盘空间。更糟糕的是，它们还会消耗很多CPU和内存。</li>
<li><strong>各种依赖。</strong>每一个<strong>客户机操作系统</strong>都需要安装许多依赖。如果你的应用需要连接PostgreSQL的话，则需要安装<strong>libpq-dev</strong>；如果你使用Ruby的话，应该需要安装gems；如果使用其他编程语言，比如Python或者Node.js，都会需要安装对应的依赖库。</li>
<li><strong>应用</strong>。安装依赖之后，就可以在各个<strong>客户机操作系统</strong>分别运行应用了，这样各个应用就是相互隔离的。</li>
</ul>
<h3 id="右图是容器化"><a href="#右图是容器化" class="headerlink" title="右图是容器化"></a>右图是容器化</h3><p><strong>从下到上理解上图:</strong></p>
<ul>
<li>**基础设施(Infrastructure)**。</li>
<li>**主操作系统(Host Operating System)**。所有主流的Linux发行版都可以运行Docker。对于MacOS和Windows，也有一些办法”运行”Docker。</li>
<li>**Docker守护进程(Docker Daemon)**。Docker守护进程取代了Hypervisor，它是运行在操作系统之上的后台进程，负责管理Docker容器。</li>
<li><strong>各种依赖</strong>。对于Docker，应用的所有依赖都打包在<strong>Docker镜像</strong>中，<strong>Docker容器</strong>是基于<strong>Docker镜像</strong>创建的。</li>
<li><strong>应用</strong>。应用的源代码与它的依赖都打包在<strong>Docker镜像</strong>中，不同的应用需要不同的<strong>Docker镜像</strong>。不同的应用运行在不同的<strong>Docker容器</strong>中，它们是相互隔离的。</li>
</ul>
<h1 id="什么是docker"><a href="#什么是docker" class="headerlink" title="什么是docker"></a>什么是docker</h1><p>一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任 何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口； 使用go语言编写，在LCX（linux容器）基础上进行的封装</p>
<p>1、提供一次性的环境，假如需要安装Mysql，则需要安装很多依赖库、版本等，如果使用Docker则通过镜像就 可以直接启动运行 </p>
<p>2、快速动态扩容，使用docker部署了一个应用，可以制作成镜像，然后通过Dokcer快速启动 </p>
<p>3、组建微服务架构，可以在一个机器上模拟出多个微服务，启动多个应用 </p>
<p>4、更好的资源隔离和共享</p>
<p>开箱即用，快速部署，可移植性强，环境隔离</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>官网： <a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<p>点击文档连接,点击manuals。点击docker engine。</p>
<p>选择操作系统，并注意版本。</p>
<p>Docker 引擎包现在称为<code>docker-ce</code>.</p>
<h3 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h3><p>较旧的 Docker 版本称为 docker 或 docker-engine 。如果已安装这些程序，请卸载它们以及相关的依赖项。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs sh">sudo yum remove docker \<br>                  docker-client \<br>                  docker-client-latest \<br>                  docker-common \<br>                  docker-latest \<br>                  docker-latest-logrotate \<br>                  docker-logrotate \<br>                  docker-engine<br></code></pre></td></tr></table></figure>

<h2 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h2><p>1.使用存储库的安装</p>
<p>2.直接下载包，安装</p>
<p>3.自动化脚本安装</p>
<h2 id="存储库方式安装"><a href="#存储库方式安装" class="headerlink" title="存储库方式安装"></a>存储库方式安装</h2><p>在新主机上首次安装 Docker Engine 之前，您需要设置 Docker 存储库。之后，您可以从存储库安装和更新 Docker。</p>
<h4 id="设置存储库"><a href="#设置存储库" class="headerlink" title="设置存储库"></a>设置存储库</h4><p>安装<code>yum-utils</code>包（提供<code>yum-config-manager</code> 实用程序）并设置存储库。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum install -y yum-utils<br></code></pre></td></tr></table></figure>

<p>官方源(比较慢)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum-config-manager \<br>    --add-repo \<br>    https://download.docker.com/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure>

<p>阿里云源</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum-config-manager \<br>    --add-repo \<br>    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure>

<h3 id="安装Docker-Engine"><a href="#安装Docker-Engine" class="headerlink" title="安装Docker Engine"></a>安装Docker Engine</h3><ol>
<li>安装<em>最新版本</em>的 Docker Engine、containerd 和 Docker Compose 或进入下一步安装特定版本：</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin<br></code></pre></td></tr></table></figure>

<p>如果提示接受 GPG 密钥，请验证指纹是否匹配 <code>060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35</code>，如果是，则接受它。</p>
<p>此命令会安装 Docker，但不会启动 Docker。它还会创建一个 <code>docker</code>组，但是默认情况下它不会将任何用户添加到该组中。</p>
<ol start="2">
<li>要安装<em>特定版本</em>的 Docker Engine，请在 repo 中列出可用版本，然后选择并安装：</li>
</ol>
<p>一个。列出并排序您的存储库中可用的版本。此示例按版本号从最高到最低对结果进行排序，并被截断：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum list docker-ce --showduplicates | <span class="hljs-built_in">sort</span> -r<br></code></pre></td></tr></table></figure>

<p>返回的列表取决于启用了哪些存储库，并且特定于您的 CentOS 版本（<code>.el7</code>在本例中由后缀表示）。</p>
<p>通过其完全限定的包名称安装特定版本，即包名称 ( <code>docker-ce</code>) 加上版本字符串（第 2 列），从第一个冒号 ( <code>:</code>) 开始，一直到第一个连字符，用连字符 ( <code>-</code>) 分隔。例如，<code>docker-ce-18.09.1</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-compose-plugin<br></code></pre></td></tr></table></figure>

<p>此命令会安装 Docker，但不会启动 Docker。它还会创建一个 <code>docker</code>组，但是默认情况下它不会将任何用户添加到该组中。</p>
<ol start="3">
<li>启动 Docker。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl start docker<br></code></pre></td></tr></table></figure>

<ol start="4">
<li><code>hello-world</code> 通过运行映像来验证 Docker 引擎是否已正确安装。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo docker run hello-world<br></code></pre></td></tr></table></figure>

<ol>
<li>此命令下载测试映像并在容器中运行它。当容器运行时，它会打印一条消息并退出。</li>
</ol>
<p>这将安装并运行 Docker 引擎。用于<code>sudo</code>运行 Docker 命令。继续<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/linux-postinstall/">Linux 后安装</a>以允许非特权用户运行 Docker 命令和其他可选配置步骤。</p>
<h3 id="升级-Docker-引擎"><a href="#升级-Docker-引擎" class="headerlink" title="升级 Docker 引擎"></a>升级 Docker 引擎</h3><p>要升级 Docker Engine，请下载较新的包文件并重复 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/#install-from-a-package">安装过程</a>，使用<code>yum -y upgrade</code> 代替<code>yum -y install</code>，并指向新文件。</p>
<h3 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure>

<h3 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker version<br></code></pre></td></tr></table></figure>

<h3 id="查看详细信息"><a href="#查看详细信息" class="headerlink" title="查看详细信息"></a>查看详细信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker info<br></code></pre></td></tr></table></figure>

<h1 id="结构图"><a href="#结构图" class="headerlink" title="结构图"></a>结构图</h1><p><img src="/.com//docker%E6%A8%A1%E5%9D%97%E5%9B%BE.svg" srcset="/img/loading.gif" lazyload alt="docker模块图"></p>
<h2 id="宿主机（Docker-Host）"><a href="#宿主机（Docker-Host）" class="headerlink" title="宿主机（Docker_Host）"></a>宿主机（Docker_Host）</h2><p>在docker中，宿主机也就是“Docker_Host”，是Docker的整体架构之一，可以是物理机也可以是虚拟机，在宿主机上跑着一个dockers服务，使用“docker daemon”可以实现对docker对象生命周期管理。</p>
<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p>镜像是文件，是只读的，提供了运行程序完整的软硬件资源，是应用程序的“集装箱”</p>
<p>类比为：操作系统的安装光盘</p>
<h2 id="Container-容器"><a href="#Container-容器" class="headerlink" title="Container(容器)"></a>Container(容器)</h2><p>是镜像的实例，由Docker负责创建，容器之间彼此隔离。</p>
<p>类比为：操作系统</p>
<h2 id="registry"><a href="#registry" class="headerlink" title="registry"></a>registry</h2><p>镜像构建完成后，可以很容易的在当前宿主机上运行，但是，如果需要在其它服务器上使用这个镜像，我们就需要一个集中的存储、分发镜像的服务，Docker Registry就是这样的服务。</p>
<p>一个 <strong>Docker Registry</strong> 中可以包含多个 <strong>仓库</strong>（<code>Repository</code>）；每个仓库可以包含多个 <strong>标签</strong>（<code>Tag</code>）；每个标签对应一个镜像。</p>
<p>通常，一个仓库会包含同一个软件不同版本的镜像，而标签就常用于对应该软件的各个版本。我们可以通过 <code>&lt;仓库名&gt;:&lt;标签&gt;</code> 的格式来指定具体是这个软件哪个版本的镜像。如果不给出标签，将以 <code>latest</code> 作为默认标签。</p>
<h3 id="Docker-Registry-公开服务"><a href="#Docker-Registry-公开服务" class="headerlink" title="Docker Registry 公开服务"></a>Docker Registry 公开服务</h3><p>Docker Registry 公开服务是开放给用户使用、允许用户管理镜像的 Registry 服务。一般这类公开服务允许用户免费上传、下载公开的镜像，并可能提供收费服务供用户管理私有镜像。</p>
<p>最常使用的 Registry 公开服务是官方的 <a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub (opens new window)</a>，这也是默认的 Registry，并拥有大量的高质量的 <a target="_blank" rel="noopener" href="https://hub.docker.com/search?q=&type=image&image_filter=official">官方镜像 (opens new window)</a>。除此以外，还有 Red Hat 的 <a target="_blank" rel="noopener" href="https://quay.io/repository/">Quay.io (opens new window)</a>；Google 的 <a target="_blank" rel="noopener" href="https://cloud.google.com/container-registry/">Google Container Registry (opens new window)</a>，<a target="_blank" rel="noopener" href="https://kubernetes.io/">Kubernetes (opens new window)</a>的镜像使用的就是这个服务；代码托管平台 <a target="_blank" rel="noopener" href="https://github.com/">GitHub (opens new window)</a>推出的 <a target="_blank" rel="noopener" href="https://docs.github.com/cn/packages/working-with-a-github-packages-registry/working-with-the-container-registry">ghcr.io (opens new window)</a>。</p>
<p>由于某些原因，在国内访问这些服务可能会比较慢。国内的一些云服务商提供了针对 Docker Hub 的镜像服务（<code>Registry Mirror</code>），这些镜像服务被称为 <strong>加速器</strong>。常见的有 <a target="_blank" rel="noopener" href="https://www.aliyun.com/product/acr?source=5176.11533457&userCode=8lx5zmtu">阿里云加速器 (opens new window)</a>、<a target="_blank" rel="noopener" href="https://www.daocloud.io/mirror#accelerator-doc">DaoCloud 加速器 (opens new window)</a>等。使用加速器会直接从国内的地址下载 Docker Hub 的镜像，比直接从 Docker Hub 下载速度会提高很多。在 <a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/install/mirror.html">安装 Docker</a> 一节中有详细的配置方法。</p>
<p>国内也有一些云服务商提供类似于 Docker Hub 的公开服务。比如 <a target="_blank" rel="noopener" href="https://c.163.com/hub#/m/library/">网易云镜像服务 (opens new window)</a>、<a target="_blank" rel="noopener" href="https://hub.daocloud.io/">DaoCloud 镜像市场 (opens new window)</a>、<a target="_blank" rel="noopener" href="https://www.aliyun.com/product/acr?source=5176.11533457&userCode=8lx5zmtu">阿里云镜像库 (opens new window)</a>等。</p>
<h3 id="私有-Docker-Registry"><a href="#私有-Docker-Registry" class="headerlink" title="私有 Docker Registry"></a>私有 Docker Registry</h3><p>除了使用公开服务外，用户还可以在本地搭建私有 Docker Registry。Docker 官方提供了 <a target="_blank" rel="noopener" href="https://hub.docker.com/_/registry/">Docker Registry (opens new window)</a>镜像，可以直接使用做为私有 Registry 服务。在 <a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/repository/registry.html">私有仓库</a> 一节中，会有进一步的搭建私有 Registry 服务的讲解。</p>
<p>开源的 Docker Registry 镜像只提供了 <a target="_blank" rel="noopener" href="https://docs.docker.com/registry/spec/api/">Docker Registry API (opens new window)</a>的服务端实现，足以支持 <code>docker</code> 命令，不影响使用。但不包含图形界面，以及镜像维护、用户管理、访问控制等高级功能。</p>
<p>除了官方的 Docker Registry 外，还有第三方软件实现了 Docker Registry API，甚至提供了用户界面以及一些高级功能。比如，<a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor">Harbor (opens new window)</a>和 <a target="_blank" rel="noopener" href="https://vuepress.mirror.docker-practice.com/repository/nexus3_registry.html">Sonatype Nexus</a>。</p>
<h1 id="镜像操作"><a href="#镜像操作" class="headerlink" title="镜像操作"></a>镜像操作</h1><p>查看本地镜像：docker images<br>搜索镜像：docker search centos<br>搜索镜像并过滤是官方的： docker search –filter “is-official&#x3D;true” centos<br>搜索镜像并过滤大于多少颗星星的：docker search –filter stars&#x3D;10 centos<br>下载centos7镜像：docker pull centos:7<br>修改本地镜像名字（小写）：docker tag centos:7 mycentos:1<br>本地镜像的删除：docker rmi centos:7</p>
<h2 id="配置镜像加速"><a href="#配置镜像加速" class="headerlink" title="配置镜像加速"></a>配置镜像加速</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">科大镜像：https://docker.mirrors.ustc.edu.cn/<br>网易：https://hub-mirror.c.163.com/<br>阿里云：https://&lt;你的ID&gt;.mirror.aliyuncs.com<br>七牛云加速器：https://reg-mirror.qiniu.com<br></code></pre></td></tr></table></figure>

<p>阿里云镜像获取地址：<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors%EF%BC%8C%E7%99%BB%E9%99%86%E5%90%8E%EF%BC%8C%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E9%80%89%E4%B8%AD%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E4%BD%A0%E7%9A%84%E4%B8%93%E5%B1%9E%E5%9C%B0%E5%9D%80%E4%BA%86%EF%BC%9A">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors，登陆后，左侧菜单选中镜像加速器就可以看到你的专属地址了：</a></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">https://&lt;你的ID&gt;.mirror.aliyuncs.com<br></code></pre></td></tr></table></figure>

<p>编辑文件vi &#x2F;etc&#x2F;docker&#x2F;daemon.json（如果文件不存在请新建该文件）</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&#123;&quot;registry-mirrors&quot;:[&quot;https://reg-mirror.qiniu.com/&quot;]&#125;<br></code></pre></td></tr></table></figure>

<p>重启：systemctl daemon-reload &amp;&amp; systemctl restart docker</p>
<h1 id="容器操作"><a href="#容器操作" class="headerlink" title="容器操作"></a>容器操作</h1><p>构建容器：docker run -itd –name&#x3D;mycentos centos:7<br>-i ：表示以交互模式运行容器（让容器的标准输入保持打开）<br>-d：表示后台运行容器，并返回容器ID<br>-t：为容器重新分配一个伪输入终端<br>–name：为容器指定名称</p>
<p>查看本地所有的容器：docker ps -a<br>查看本地正在运行的容器：docker ps<br>停止容器：docker stop CONTAINER_ID &#x2F; CONTAINER_NAME<br>一次性停止所有容器：docker stop $(docker ps -a -q)<br>启动容器：docker start CONTAINER_ID &#x2F; CONTAINER_NAME<br>重启容器：docker restart CONTAINER_ID &#x2F; CONTAINER_NAME<br>删除容器：docker rm CONTAINER_ID &#x2F; CONTAINER_NAME<br>强制删除容器：docker rmi -f CONTAINER_ID &#x2F; CONTAINER_NAME<br>查看容器详细信息：docker inspect CONTAINER_ID &#x2F; CONTAINER_NAME<br>进入容器：docker exec -it 0ad5d7b2c3a4 &#x2F;bin&#x2F;bash</p>
<h1 id="容器与宿主机操作"><a href="#容器与宿主机操作" class="headerlink" title="容器与宿主机操作"></a>容器与宿主机操作</h1><h2 id="容器与宿主机端口映射"><a href="#容器与宿主机端口映射" class="headerlink" title="容器与宿主机端口映射"></a>容器与宿主机端口映射</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -p 宿主机端口:容器端口  镜像名<br></code></pre></td></tr></table></figure>

<h2 id="容器与宿主机之间文件复制与挂载"><a href="#容器与宿主机之间文件复制与挂载" class="headerlink" title="容器与宿主机之间文件复制与挂载"></a>容器与宿主机之间文件复制与挂载</h2><p>从宿主机复制到容器：docker cp 宿主机本地路径 容器名字&#x2F;ID：容器路径<br>docker cp &#x2F;root&#x2F;123.txt mycentos:&#x2F;home&#x2F;<br>从容器复制到宿主机：docker cp 容器名字&#x2F;ID：容器路径 宿主机本地路径<br>docker cp mycentos:&#x2F;home&#x2F;456.txt &#x2F;root<br>宿主机文件夹挂载到容器里：docker run -itd -v 宿主机路径:容器路径 镜像ID<br>docker run -itd -v &#x2F;root&#x2F;xdclass&#x2F;:&#x2F;home centos:7</p>
<h1 id="commit构建自定义镜像"><a href="#commit构建自定义镜像" class="headerlink" title="commit构建自定义镜像"></a>commit构建自定义镜像</h1><p>对容器的修改以及保存</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs text">启动并进入容器：docker run -it centos:7 /bin/bash<br>在/home 路径下创建xdclass文件夹：mkdir /home/xdclass<br>安装ifconfig命令：yum -y install net-tools<br>重启容器，查看容器的xdclass文件夹还在不在：docker restart 67862569d4f7<br>删除容器，再重新启动一个容器进入查看有没有xdclass文件夹：docker rm 67862569d4f7 &amp;&amp; docker<br>run -it centos:7 /bin/bash<br>构建镜像：<br>  docker commit 4eb9d14ebb18 mycentos:7<br>  docker commit -a &quot;XD&quot; -m &quot;mkdir /home/xdclass&quot; 4eb9d14ebb18 mcentos:7<br>  -a：标注作者<br>  -m：说明注释<br>  查看详细信息：docker inspect 180176be1b4c<br>启动容器：docker run -itd 180176be1b4c /bin/bash<br>进入容器查看：docker exec -it 2a4d38eca64f /bin/bash<br></code></pre></td></tr></table></figure>

<h1 id="Dockerfile构建镜像"><a href="#Dockerfile构建镜像" class="headerlink" title="Dockerfile构建镜像"></a>Dockerfile构建镜像</h1><p>Dockerfile文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text"># this is a dockerfile<br>FROM centos:7<br>MAINTAINER XD 123456@qq.com<br>RUN echo &quot;正在构建镜像！！！&quot;<br>WORKDIR /home/xdclass<br>COPY 123.txt /home/xdclass<br>RUN yum install -y net-tools<br></code></pre></td></tr></table></figure>

<p>构建：docker build -t mycentos:v2 </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">docker build -t 机构/镜像名&lt;:tags&gt; Dockerfile目录<br></code></pre></td></tr></table></figure>

<p>查看：docker images<br>进入验证：验证成功</p>
<h2 id="Dockerfile基础指令"><a href="#Dockerfile基础指令" class="headerlink" title="Dockerfile基础指令"></a>Dockerfile基础指令</h2><p>FROM<br>    基于哪个镜像<br>MAINTAINER<br>    注明作者<br>COPY<br>    复制文件进入镜像（只能用相对路径，不能用绝对路径）<br>ADD<br>    复制文件进入镜像（假如文件是.tar.gz文件会解压）<br>WORKDIR：<br>    指定工作目录，假如路径不存在会创建路径<br>ENV<br>    设置环境变量<br>EXPOSE<br>    暴露容器端口<br>RUN</p>
<p>​	在构建镜像的时候执行，作用于镜像层面</p>
<p>ENTRYPOINT<br>    在容器启动的时候执行，作用于容器层，dockerfile里有多条时只允许执行最后一条<br>CMD<br>    在容器启动的时候执行，作用于容器层，dockerfile里有多条时只允许执行最后一条<br>    容器启动后执行默认的命令或者参数，允许被修改<br>命令格式：<br>shell命令格式：RUN yum install -y net-tools<br>exec命令格式：RUN [ “yum”,”install” ,”-y” ,”net-tools”]</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">#第一个<br>FROM centos:7<br>RUN echo &quot;images building!&quot;<br>CMD [&quot;echo&quot;,&quot;container&quot;,&quot;starting...&quot;]<br>ENTRYPOINT [&quot;echo&quot;,&quot;container&quot;,&quot;starting ！！！&quot;]<br><br>#第二个<br>FROM centos:7<br>RUN echo &quot;images building!&quot;<br>CMD [&quot;echo&quot;,&quot;containe1r&quot;,&quot;starting...&quot;]<br>CMD [&quot;echo&quot;,&quot;container2&quot;,&quot;starting...&quot;]<br>ENTRYPOINT [&quot;echo&quot;,&quot;container2&quot;,&quot;starting ！！！&quot;]<br>ENTRYPOINT [&quot;echo&quot;,&quot;container2&quot;,&quot;starting ！！！&quot;]<br><br>#第三个<br>FROM centos:7<br>CMD [&quot;-ef&quot;]<br>ENTRYPOINT [&quot;ps&quot;]<br></code></pre></td></tr></table></figure>

<h2 id="Dockerfile构建tomcat"><a href="#Dockerfile构建tomcat" class="headerlink" title="Dockerfile构建tomcat"></a>Dockerfile构建tomcat</h2><p>本地宿主机配置jdk</p>
<p>vi &#x2F;etc&#x2F;profile</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">export JAVA_HOME=/usr/local/jdk<br>export JRE_HOME=$JAVA_HOME/jre<br>export CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH<br>export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH<br></code></pre></td></tr></table></figure>

<p>source &#x2F;etc&#x2F;profile<br>检验：java -version</p>
<p>Dockerfile文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs text">FROM centos:7<br>ADD jdk-8u211-linux-x64.tar.gz /usr/local<br>RUN mv /usr/local/jdk1.8.0_211 /usr/local/jdk<br>ENV JAVA_HOME=/usr/local/jdk<br>ENV JRE_HOME=$JAVA_HOME/jre<br>ENV CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH<br>ENV PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH<br>ADD apache-tomcat-8.5.35.tar.gz /usr/local<br>RUN mv /usr/local/apache-tomcat-8.5.35 /usr/local/tomcat<br>EXPOSE 8080<br>ENTRYPOINT [&quot;/usr/local/tomcat/bin/catalina.sh&quot;,&quot;run&quot;]<br></code></pre></td></tr></table></figure>

<p>启动容器</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">docker run -itd -p 80:8080 -v /root/test/ROOT:/usr/local/tomcat/webapps/ROOT<br>mycentos:jdk /bin/bash<br></code></pre></td></tr></table></figure>

<h2 id="Dockerfile构建"><a href="#Dockerfile构建" class="headerlink" title="Dockerfile构建"></a>Dockerfile构建</h2><p>Dockerfile文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">FROM centos:7<br>ADD nginx-1.16.0.tar.gz /usr/local<br>COPY nginx_install.sh /usr/local<br>RUN sh /usr/local/nginx_install.sh<br>EXPOSE 80<br></code></pre></td></tr></table></figure>

<p>安装nginx的shell脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br>yum install -y gcc gcc-c++ make pcre pcre-devel zlib zlib-devel<br><span class="hljs-built_in">cd</span> /usr/local/nginx-1.16.0<br>./configure --prefix=/usr/local/nginx &amp;&amp; make &amp;&amp; make install<br></code></pre></td></tr></table></figure>

<p>制作Nginx镜像</p>
<p>​	docker build -t mycentos:nginx .</p>
<p>Nginx镜像启动注意</p>
<p>​	在容器里nginx是以daemon方式启动，退出容器时，nginx程序也会随着停止：<br>​	&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx<br>​	使用前台方式永久运行：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -g “daemon off;”</p>
<p>运行：</p>
<p>docker run -itd -p 80:80 mycentos:nginx &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -g “daemon off;”</p>
<h1 id="镜像分层"><a href="#镜像分层" class="headerlink" title="镜像分层"></a>镜像分层</h1><p>1.构建测试镜像v1.0：<code>docker build -t image_test:1.0 .</code></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">FROM</span> alpine:<span class="hljs-number">3</span>.<span class="hljs-number">15</span>.<span class="hljs-number">0</span> #除了继承基础镜像，啥也不做<br></code></pre></td></tr></table></figure>

<p>2.构建测试镜像v2.0：<code>docker build -t image_test:2.0 .</code></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> alpine:3.15.0<br><span class="hljs-built_in">RUN</span> dd <span class="hljs-attribute">if</span>=/dev/zero <span class="hljs-attribute">of</span>=file1 <span class="hljs-attribute">bs</span>=10M <span class="hljs-attribute">count</span>=1 #添加一个10M的文件file1<br></code></pre></td></tr></table></figure>

<p>3.构建测试镜像v3.0：<code>docker build -t image_test:3.0 .</code></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">FROM</span> alpine:3.15.0<br><span class="hljs-built_in">RUN</span> dd <span class="hljs-attribute">if</span>=/dev/zero <span class="hljs-attribute">of</span>=file1 <span class="hljs-attribute">bs</span>=10M <span class="hljs-attribute">count</span>=1 #添加一个10M的文件file1<br><span class="hljs-built_in">RUN</span> dd <span class="hljs-attribute">if</span>=/dev/zero <span class="hljs-attribute">of</span>=file2 <span class="hljs-attribute">bs</span>=10M <span class="hljs-attribute">count</span>=1 #添加一个10M的文件file2<br></code></pre></td></tr></table></figure>

<p>使用<code>docker history</code>可以看到镜像的构建历史。<br>我们每一行列出了镜像包含的层。</p>
<p>使用<code>docker history</code>我们看到有一行很特别，就是镜像ID为的行，这一行是什么呢？<br>看了 <a target="_blank" rel="noopener" href="https://docs.docker.com/storage/storagedriver/">官方文档</a> 的描述，我们知道这些构建步骤要么是构建在另一个系统，要么是镜像的部分是从DockerHub上拉取下来的，要么是使用的是另一种构建工具BuildKit构建的。<br>很显然，我们这里就是第二种情况，因为我们的Dockerfile中第一句指令就是<code>FROM alpine:3.15.0</code>.</p>
<p><img src="/.com//%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82.png" srcset="/img/loading.gif" lazyload alt="镜像分层"></p>
<p>从上面的图可以看到，我们的镜像是分层的，我们的Dockerfile中新增一条指令，就会新增一层！<br>如果我们将多个命令合成一个，那么也只会生成一层。修改一下上面的image_test:3.0，把两条RUN合并成一条</p>
<p>如果我们将多个命令合成一个，那么也只会生成一层。修改一下上面的image_test:3.0，把两条RUN合并成一条：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">FROM alpine:3.15.0<br>RUN dd if=/dev/zero of=file1 bs=10M count=1 &amp;&amp; \<br>    dd if=/dev/zero of=file2 bs=10M count=1<br></code></pre></td></tr></table></figure>

<p>使用<code>docker history</code> 查看image_test:4.0，可以看到，只有2层了！</p>
<h2 id="镜像分层的好处"><a href="#镜像分层的好处" class="headerlink" title="镜像分层的好处"></a>镜像分层的好处</h2><ul>
<li>拉取<strong>更快</strong>：因为分层了，只需拉取本地不存在的层即可！</li>
<li>存储<strong>更少</strong>：因为共同的层只需存储一份即可！</li>
<li>运行时存储<strong>更少</strong>：容器运行时可以共享相同的层！</li>
</ul>
<h1 id="docker网络模式与通信"><a href="#docker网络模式与通信" class="headerlink" title="docker网络模式与通信"></a>docker网络模式与通信</h1><p>默认的三种网络模式：<br>bridge：桥接模式<br>host：主机模式<br>none：无网络模式<br>查看网络模式：<br>docker network ls</p>
<p><img src="/.com//%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F.png" srcset="/img/loading.gif" lazyload alt="网络模式"></p>
<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><p>桥接模式是docker 的默认网络设置，当Docker服务启动时，会在主机上创建一个名为docker0的虚拟网桥，并<br>选择一个和宿主机不同的IP地址和子网分配给docker0网桥</p>
<p>安装工具：<br>yum -y install net-tools<br>yum install -y bridge-utils</p>
<p>查看桥接情况：<br>brctl show</p>
<h2 id="host模式"><a href="#host模式" class="headerlink" title="host模式"></a>host模式</h2><p>该模式下容器是不会拥有自己的ip地址，而是使用宿主机的ip地址和端口。</p>
<p>启动nginx容器命令并防火墙放开80端口：<br>docker run -d –net&#x3D;host mycentos:nginx &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -g “daemon off;”<br>firewall-cmd –zone&#x3D;public –add-port&#x3D;80&#x2F;tcp –permanent<br>firewall-cmd –reload</p>
<h2 id="none模式"><a href="#none模式" class="headerlink" title="none模式"></a>none模式</h2><p>none模式：关闭模式<br>无法连外网</p>
<h2 id="Docker-容器间基于Link实现单向通信"><a href="#Docker-容器间基于Link实现单向通信" class="headerlink" title="Docker 容器间基于Link实现单向通信"></a>Docker 容器间基于Link实现单向通信</h2><p>启动mysql数据库容器：<br>docker run –name mydb -e MYSQL_ROOT_PASSWORD&#x3D;abc123456 -d mysql:5.7<br>启动tomcat应用容器并link到mysql数据库：<br>docker run -itd –name tomcat1 –link mydb tomcat:tag注意：mydb 这个容器一定要存在！<br>官方版的mysql 5.7 需要安装工具才有ping命令:<br>apt-get update &amp;&amp; apt-get install iputils-ping</p>
<h2 id="Docker容器间利用brige网桥实现双向通信"><a href="#Docker容器间利用brige网桥实现双向通信" class="headerlink" title="Docker容器间利用brige网桥实现双向通信"></a>Docker容器间利用brige网桥实现双向通信</h2><p>执行：docker network ls</p>
<p>创建一个新的网桥：docker network create -d bridge my_bridge<br>启动第一个容器：docker run -itd –name tomcat centos:7<br>启动第二个容器：docker run -itd –name redis centos:7<br>把第一个容器加入网桥：docker network connect my_bridge tomcat<br>把第二个容器加入网桥：docker network connect my_bridge redis<br>最后分别进入俩个容器中进行验证</p>
<h2 id="特权模式"><a href="#特权模式" class="headerlink" title="特权模式"></a>特权模式</h2><p>启动一个普通的容器<br>docker run -itd –name mycentos centos:7 &#x2F;bin&#x2F;bash<br>安装网络工具：<br>yum -y install net-tools<br>执行route -n<br>删除网关：<br>route del default gw 172.17.0.1<br>启动拥有特权模式的容器：</p>
<p>docker run -itd –privileged&#x3D;true –name mycentos1 centos:7 &#x2F;bin&#x2F;bash<br>进入容器：<br>docker exec -it ef &#x2F;bin&#x2F;bash<br>删除网关<br>route del default gw 172.17.0.1<br>成功<br>备注：特权模式用的比较少</p>
<h2 id="Volume数据共享"><a href="#Volume数据共享" class="headerlink" title="Volume数据共享"></a>Volume数据共享</h2><p>dockerfile</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">FROM centos:7<br>VOLUME [&quot;/usr/local&quot;]<br></code></pre></td></tr></table></figure>

<p>注意：在dockerfile里设置volume是无法修改宿主机的挂载路径的</p>
<p>使用volume容器共享创建nginx集群<br>使用–volumes-from 实现容器与容器之间volume共享<br>创建nginx1<br>docker run -itd -p 8080:80 -v &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html:&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html –name nginx1<br>mycentos:nginx &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -g “daemon off;”<br>创建nginx2<br>docker run -itd -p 8081:80 –volumes-from nginx1 –name nginx2 mycentos:nginx<br>&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -g “daemon off;”<br>创建nginx3<br>docker run -itd -p 8082:80 –volumes-from nginx1 –name nginx3 mycentos:nginx<br>&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -g “daemon off;”<br>对&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html&#x2F;index.html进行修改<br>打开浏览器进行访问测试<br>使用docker inspect 容器ID 可以查看详细的挂载信息</p>
<h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h1><p>docker-compose：是一个用于定义和运行多容器 Docker 的应用程序工具，可以帮助我们可以轻松、高效的管理容器.</p>
<p>查看docker-compose版本：(docker-compose version  老版本的)<br>docker compose version</p>
<h2 id="运行WordPress"><a href="#运行WordPress" class="headerlink" title="运行WordPress"></a>运行WordPress</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com/samples/wordpress/">https://docs.docker.com/samples/wordpress/</a></p>
<ol>
<li>创建一个空的项目目录。</li>
<li>切换到您的项目目录。</li>
<li>创建docker-compose.yml</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-comment"># We use a mariadb image which supports both amd64 &amp; arm64 architecture</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mariadb:10.6.4-focal</span><br>    <span class="hljs-comment"># If you really want to use MySQL, uncomment the following line</span><br>    <span class="hljs-comment">#image: mysql:8.0.27</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">&#x27;--default-authentication-plugin=mysql_native_password&#x27;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db_data:/var/lib/mysql</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=somewordpress</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_DATABASE=wordpress</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_USER=wordpress</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_PASSWORD=wordpress</span><br>    <span class="hljs-attr">expose:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">33060</span><br>  <span class="hljs-attr">wordpress:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress:latest</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">80</span><span class="hljs-string">:80</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">WORDPRESS_DB_HOST=db</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">WORDPRESS_DB_USER=wordpress</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">WORDPRESS_DB_PASSWORD=wordpress</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">WORDPRESS_DB_NAME=wordpress</span><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">db_data:</span><br></code></pre></td></tr></table></figure>

<p>构建：</p>
<p>docker compose up -d</p>
<p>在浏览器中打开wordPress  <a target="_blank" rel="noopener" href="http://localhost:8000/">http://localhost:8000</a></p>
<p>关闭和清理</p>
<p>该命令<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/compose_down/"><code>docker compose down</code></a>会删除容器和默认网络，但会保留您的 WordPress 数据库。</p>
<p>该命令<code>docker compose down --volumes</code>删除容器、默认网络和 WordPress 数据库。</p>
<h2 id="compose命令"><a href="#compose命令" class="headerlink" title="compose命令"></a>compose命令</h2><p>compose操作容器（一定要进入配置文件目录）<br>后台启动容器：docker compose up -d<br>查看容器运行情况：docker compose ps<br>停止并删除容器：docker compose down<br>停止并删除容器并删除volume：docker compose down –volumes<br>停止启动容器：docker-compose stop；docker-compose start<br>docker-compose exec的使用：docker-compose exec redis bash</p>
<h2 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h2><p>docker-compose.yml的三大部分：version，services，networks，最关键是services和networks两个部分<br>compose设置网络模式<br>compose使用端口映射<br>compose设置文件共享<br>compose管理多个容器</p>
<p>docker-compose.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>	<span class="hljs-attr">nginx:</span><br>		<span class="hljs-attr">image:</span> <span class="hljs-string">mycentos:nginx</span><br>		<span class="hljs-attr">network_mode:</span> <span class="hljs-string">&quot;host&quot;</span><br>		<span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/home:/usr/local/nginx/html</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/logs/nginx/logs:/usr/local/nginx/logs</span><br>      <span class="hljs-attr">command:</span> <span class="hljs-string">/usr/local/nginx/sbin/nginx</span> <span class="hljs-string">-g</span> <span class="hljs-string">&quot;daemon off;&quot;</span><br>	<span class="hljs-attr">redis:</span><br>		<span class="hljs-attr">image:</span> <span class="hljs-string">mycentos:redis</span><br>		<span class="hljs-attr">ports:</span><br>		<span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6380:6379&quot;</span><br></code></pre></td></tr></table></figure>

<h1 id="阿里云镜像仓库"><a href="#阿里云镜像仓库" class="headerlink" title="阿里云镜像仓库"></a>阿里云镜像仓库</h1><p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-shanghai/instances/repositories">https://cr.console.aliyun.com/cn-shanghai/instances/repositories</a></p>
<h1 id="harbor仓库"><a href="#harbor仓库" class="headerlink" title="harbor仓库"></a>harbor仓库</h1><h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2><p>安装 yum -y install openssl</p>
<p>下载 <a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/releases">https://github.com/goharbor/harbor/releases</a></p>
<p>上传对应安装包<br>修改配置：harbor.yml<br>修改主机名（注意空格）：hostname: 192.168.0.151<br>修改密码（注意空格）：harbor_admin_password: Harbor12345</p>
<p>执行脚本：sh prepare</p>
<p>执行安装命令：sh install.sh<br>执行命令：docker-compose ps<br>访问Harbor，默认用户名admin<br>关闭：docker-compose down<br>启动：docker-compose up -d</p>
<h2 id="配置与使用harbor仓库"><a href="#配置与使用harbor仓库" class="headerlink" title="配置与使用harbor仓库"></a>配置与使用harbor仓库</h2><p>Docker配置使用自建仓库<br>    默认docker只允许访问 https仓库<br>    如果要访问http仓库需要自己配置<br>配置允许访问http仓库：&#x2F;etc&#x2F;docker&#x2F;daemon.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span> <br>  <span class="hljs-attr">&quot;insecure-registries&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">&quot;http://192.168.0.151&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>重启docker服务：systemctl restart docker.service<br>网页上创建项目名<br>登录：docker login –username&#x3D;admin 192.168.0.151<br>改名：docker tag mysql:5.7 192.168.0.151&#x2F;xx&#x2F;mysql:5.7<br>推送：docker push 192.168.0.151&#x2F;xx&#x2F;mysql:5.7<br>下载：docker pull 192.168.0.151&#x2F;xx&#x2F;mysql:5.7<br>docker login 后有一个登录凭证（可删除，下次需要密码）：<br>&#x2F;root&#x2F;.docker&#x2F;config.json （建议从安全角度出发，每次登录后进行删除）</p>
<h1 id="镜像的本地载入载出"><a href="#镜像的本地载入载出" class="headerlink" title="镜像的本地载入载出"></a>镜像的本地载入载出</h1><p>两种办法：</p>
<p>保存镜像<br>保存容器</p>
<p>保存镜像：<br>docker save cd3ed0dfff7e -o &#x2F;home&#x2F;mysql.tar<br>docker save mysql:5.7 &gt; &#x2F;home&#x2F;mysql.tar<br>载入镜像：<br>docker load -i mysql.tar<br>保存容器：<br>docker export 974b919e1fdd -o &#x2F;home&#x2F;mysql-export.tar<br>载入容器：<br>docker import mysql-export.tar</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/devops/">devops</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/docker/">docker</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/05/30/nginx/nginx%E5%9C%B0%E5%9D%80%E6%88%AA%E6%96%AD/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">nginx地址截断</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/10/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E5%B9%B6%E5%8F%91%E6%95%B0/">
                        <span class="hidden-mobile">如何计算并发数</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        京ICP备18028493号
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502035713"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
            
            <span>11010502035713</span>
          </a>
        </span>
      
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
